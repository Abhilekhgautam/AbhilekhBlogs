<!DOCTYPE html>
<html lang="en">
    <head>
        
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <meta name="description" content="Abhilekh&#x27;s Blog site. Mostly about programming.">
        

        <title>Abhilekh Blogs</title>

        
            <link rel="stylesheet" href="https://blog.abhilekhgautam.com.np/theme.css">
        
        
    </head>
    <body>
        <div class="content">
        
        
            <header>
                <div class="header-left">
                    <a href="https:&#x2F;&#x2F;blog.abhilekhgautam.com.np" class="logo">Abhilekh Blogs</a>
                </div>
                <div class="header-right">
                    <nav itemscope itemtype="http://schema.org/SiteNavigationElement">
                      <ul>
                        
                        
                            
                            <li class="nav">
                                <a itemprop="url" href="https://blog.abhilekhgautam.com.np/blog/">
                                    <span itemprop="name">Abhilekh Blogs</span>
                                </a>
                            </li>
                        
                        
                        <li class="nav">
                            <a itemprop="url" href="https://github.com/Abhilekhgautam">
                                <img class="icon" src="https:&#x2F;&#x2F;blog.abhilekhgautam.com.np/icons/github.svg" alt="Github">
                            </a>
                        </li>
                        
                        
                        <li class="nav">
                            <a itemprop="url" href="https://twitter.com/abhilekh_gautam">
                                <img class="icon" src="https:&#x2F;&#x2F;blog.abhilekhgautam.com.np/icons/twitter.svg" alt="Twitter">
                            </a>
                        </li>
                        
                      </ul>
                    </nav>
                </div>
            </header>
        
        
        <main>
            
<article itemscope itemtype="http://schema.org/BlogPosting">
    <div itemprop="headline">
        <h1>Stalking the C++ compiler</h1>
        <div class="border"></div>
        <time datetime="2024-06-17" class="date" itemprop="datePublished">
            17 Jun 2024
        </time>
    </div>
    <div itemprop="articleBody">
        <p>In this article, we will look into the code generated by the C++ compiler and understand whats happening under the hood.</p>
<p>So here is the program which we will work on:</p>
<pre data-lang="cpp" style="background-color:#2b303b;color:#c0c5ce;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span>
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>  </span><span style="color:#b48ead;">int</span><span> x = </span><span style="color:#d08770;">5</span><span>;
</span><span>
</span><span>  x = x + </span><span style="color:#d08770;">1</span><span>;
</span><span>
</span><span>  </span><span style="color:#b48ead;">int</span><span> y = x;
</span><span>
</span><span>  y = x + </span><span style="color:#d08770;">7</span><span>;
</span><span>}
</span></code></pre>
<p>This program does nothing interesting but we can learn a lot if we start looking into the generated assembly.</p>
<p>I'll use godbolt's <a href="https://godbolt.org/">Compiler Explorer</a> to quickly get the generated assembly for <code>x86_64</code>.</p>
<p>What I got from <code>x86_64 gcc 14.1</code> with no optimization enabled is:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#8fa1b3;">main:
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">push    </span><span style="color:#bf616a;">rbp
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">mov     </span><span style="color:#bf616a;">rbp</span><span>, </span><span style="color:#bf616a;">rsp
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">mov     </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>], </span><span style="color:#d08770;">5
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">add     </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>], </span><span style="color:#d08770;">1
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">mov     </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>]
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">sub     </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#d08770;">1
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">mov     </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">8</span><span>], </span><span style="color:#bf616a;">eax
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">mov     </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>]
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">add     </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#d08770;">7
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">mov     </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">8</span><span>], </span><span style="color:#bf616a;">eax
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">mov     </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#d08770;">0
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">pop     </span><span style="color:#bf616a;">rbp
</span><span style="color:#8fa1b3;">    </span><span style="color:#b48ead;">ret
</span></code></pre>
<h2 id="x86-64-linux-assembly-basics">x86_64 Linux Assembly Basics</h2>
<p>I'll quickly give a walk through of assembly instructions used here:</p>
<ol>
<li>
<p><code>push A</code>: Pushes <code>A</code> into the stack.</p>
</li>
<li>
<p><code>mov D, S</code>:  Copy the content at <code>S</code> to <code>D</code> </p>
</li>
<li>
<p><code>add A, B</code>: Add the content at <code>A</code> and <code>B</code> and stores the result into <code>A</code>.</p>
</li>
<li>
<p><code>sub A, B</code>: Get the difference from <code>A</code> to <code>B</code> and store the result in <code>A</code>.</p>
</li>
<li>
<p><code>pop B</code>: Pop an element from the stack and store into <code>B</code>.</p>
</li>
<li>
<p><code>ret</code>: Return from the function (We'll look into what exactly it means later.)</p>
</li>
</ol>
<p>If we ignore all the nitty-gritty here and look at the fourth line of the generated assembly, i.e.,</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">mov </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>], </span><span style="color:#d08770;">5
</span></code></pre>
<p>We don't know what <code>DWORD PTR [rbp-4]</code> is, but with the knowledge we have gained so far. We are pretty sure
that it is copying the value <code>5</code> somewhere (we'll look exactly where later) lets say to <code>[rbp-4]</code> for now.
It is exactly what the following C++ code is expected to do:</p>
<pre data-lang="cpp" style="background-color:#2b303b;color:#c0c5ce;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span style="color:#b48ead;">int</span><span> x = </span><span style="color:#d08770;">5</span><span>; </span><span style="color:#65737e;">// Write the value 5 to some memory location and name it x.
</span></code></pre>
<p>Lets move on to the next assembly instruction:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">add </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>], </span><span style="color:#d08770;">1
</span></code></pre>
<p>We again ignore <code>DWORD PTR [rbp-4]</code> for now. But we are pretty sure it is adding the value <code>1</code> with the content
at <code>[rbp-4]</code> (We exactly don't know what it is) and stores back the value at <code>[rbp-4]</code>. Previously we stored the value <code>5</code>
at <code>[rbp-4]</code> now we added <code>1</code> to it. So it must store the value <code>6</code> now. It is exactly what the following C++ code is
expected to do:</p>
<pre data-lang="cpp" style="background-color:#2b303b;color:#c0c5ce;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span>x = x + </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#65737e;">// add 1 to the value of x and store the result in x itself.
</span></code></pre>
<p>Next assembly instruction we look at is:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">mov </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>]
</span></code></pre>
<p>This is again a move instruction. We still don't know what <code>DWORD PTR [rbp-4]</code> means and we also don't know what <code>eax</code> means
but we are pretty sure we are copying the value at <code>[rbp-4]</code> to <code>eax</code>. If it is, <code>eax</code> now holds the value <code>6</code>. We haven't exactly
written the equivalent C++ line for this generated assembly, this is what compiler felt the need to generate itself.</p>
<p>The next instruction is:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">sub </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#d08770;">1
</span></code></pre>
<p>We yet don't know what <code>eax</code> is but we are sure, we are subtracting the value at <code>eax</code> which is <code>6</code> by <code>1</code>, so <code>eax</code> now holds <code>5</code>.
To summarize previous assembly instructions:</p>
<ol>
<li>
<p><code>[rbp-4]</code> holds the value our variable <code>x</code> is expected to hold, i.e., <code>6</code></p>
</li>
<li>
<p>Copy the value at <code>[rbp-4]</code> to <code>eax</code>.</p>
</li>
<li>
<p>Subtracted the value at <code>eax</code> by one.</p>
</li>
</ol>
<p>So what we can conclude is we have the value <code>x-1</code> at <code>eax</code>.
Looks like our Compiler is preparing for the following C++ code.</p>
<pre data-lang="cpp" style="background-color:#2b303b;color:#c0c5ce;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span style="color:#b48ead;">int</span><span> y = x - </span><span style="color:#d08770;">1</span><span>;
</span></code></pre>
<p>It has already obtained the value for <code>x-1</code> and stored at <code>eax</code>. It now just need to copy this value at <code>eax</code> to some location
which it does using:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">mov </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">8</span><span>], </span><span style="color:#bf616a;">eax
</span></code></pre>
<p>We exactly don't know what <code>DWORD PTR [rbp-8]</code> does, but we are here copying the value at <code>eax</code> which holds <code>x-1</code> to some location <code>[rbp-8]</code>.</p>
<p>The upcoming instructions are similar to the previous ones:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">mov </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>]
</span><span style="color:#b48ead;">add </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#d08770;">7
</span><span style="color:#b48ead;">mov </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">8</span><span>], </span><span style="color:#bf616a;">eax
</span></code></pre>
<p>This simply achieves what is expected from the following C++ code:</p>
<pre data-lang="cpp" style="background-color:#2b303b;color:#c0c5ce;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span>y = x + </span><span style="color:#d08770;">7</span><span>;
</span></code></pre>
<p>To Summarize: </p>
<ol>
<li>
<p><code>[rbp-4]</code> holds the value, <code>x</code> is expected to store.</p>
</li>
<li>
<p>Copy the value at [rbp-4], i.e., value of <code>x</code> to <code>eax</code>.</p>
</li>
<li>
<p>Add <code>7</code> to the value at <code>eax</code>, <code>eax</code> now holds the value of <code>x + 7</code>.</p>
</li>
<li>
<p>Copy the value at <code>eax</code> <code>(x + 7)</code> to some location <code>[rbp-8]</code>.</p>
</li>
</ol>
<p>Too much of abstraction so far. Lets dive somewhat deeper now.</p>
<h2 id="storage-organization">Storage Organization</h2>
<p>Every program run in its own address space, which can be divided in the following way.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>      ------------------------
</span><span>      |        Code          |
</span><span>      ------------------------
</span><span>      |        Static        |
</span><span>      ------------------------
</span><span>      |        Heap          |
</span><span>      ------------------------
</span><span>      |       Free Memory    |   
</span><span>      ------------------------
</span><span>      |       Stack          |   
</span><span>      ------------------------
</span></code></pre>
<h3 id="code">Code</h3>
<p>The generated code is kept in this region. It's size is fixed.</p>
<h3 id="static">Static</h3>
<p>Things like global constants are placed in the region called Static.</p>
<h3 id="heap">Heap</h3>
<p>Heap is dynamic in nature. It is used to manage data that may outlive the call to procedure(function) that created it. Heaps grow downwards i.e, towards the higher memory address.</p>
<h3 id="stack">Stack</h3>
<p>Stack is also dynamic in nature. It is used to store data structures called activation record(also known as stack frame or call frame) that are generated during function call. Stack grows upwards i.e., towards lower memory address. This concept is necessary when we start talking about <code>rbp</code>.</p>
<p>Whenever a procedure is called, space for the variables are created in the stack, i.e., push operations are performed for the local variables. When the procedure terminates the space is popped off the stack. This should be enough to justify the statement that, stack is dynamic.</p>
<h2 id="cpu-registers">CPU Registers</h2>
<p>Registers are memory unit within the CPU. Since they are within the CPU (processor) they are very quick to access. The properties of the registers are processor dependent. Anyways we will look into very few registers used by the compiler in the previously generated code.</p>
<ol>
<li>
<p><code>eax</code>: 32 bit general purpose register.</p>
</li>
<li>
<p><code>rsp</code>: Stack Pointer Register. Points to the current top of the stack. It stores the address of the current top of stack.</p>
</li>
<li>
<p><code>rbp</code>: Base Pointer Register. Used as a reference pointer during function call.</p>
</li>
</ol>
<p>Now we have all the basics required to look into the entire generated assembly.</p>
<h2 id="revisiting-the-generated-assembly">Revisiting the generated assembly</h2>
<p>I'll start by assuming that the main function has already been called.</p>
<p>When the first instruction is executed</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">push </span><span style="color:#bf616a;">rbp
</span></code></pre>
<p>the stack looks like the following:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>|                     |
</span><span>-----------------------
</span><span>|       rbp           | &lt;- rsp
</span><span>-----------------------
</span><span>|                     |
</span><span>-----------------------
</span><span>|                     |
</span><span>
</span><span>Fig: The current stack status.
</span></code></pre>
<p>The next instruction:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">mov </span><span style="color:#bf616a;">rbp</span><span>, </span><span style="color:#bf616a;">rsp
</span></code></pre>
<p>copies the value of <code>rsp</code> into <code>rbp</code>. What this means is, <code>rbp</code> now holds the address of the current top of stack.</p>
<p>The next instruction:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">mov </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>], </span><span style="color:#d08770;">5
</span></code></pre>
<p>puts the value <code>5</code> to a memory location that is <code>4</code> bytes below the address currently stored by <code>rbp</code>.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>|                    |
</span><span>----------------------
</span><span>|        5           |
</span><span>----------------------
</span><span>|       rbp          | &lt;-rsp
</span><span>----------------------
</span><span>|                    |
</span><span>----------------------
</span><span>|                    |
</span><span>
</span><span>Fig: The current stack status after first move.
</span></code></pre>
<p>The next instruction then add the value <code>1</code> to the content at <code>[rbp-4]</code>.</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">add </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>], </span><span style="color:#d08770;">1
</span></code></pre>
<p>The stack now looks like:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>|                    |
</span><span>----------------------
</span><span>|        6           |
</span><span>----------------------
</span><span>|       rbp          | &lt;-rsp
</span><span>----------------------
</span><span>|                    |
</span><span>
</span><span>Fig: The current stack status after the first add operation.
</span></code></pre>
<p>The next instruction copies the value at <code>[rbp-4]</code> into the eax register.</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">mov </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>]
</span></code></pre>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>|                    |
</span><span>----------------------       -----
</span><span>|        6           |       |eax|
</span><span>----------------------       -----
</span><span>|       rbp          | &lt;-rsp | 6 |
</span><span>----------------------       -----
</span><span>|                    |
</span><span>
</span><span>Fig: The current stack status and the value at eax register.
</span></code></pre>
<p>The next instruction:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">sub </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#d08770;">1
</span></code></pre>
<p>subtracts the value at <code>eax</code> by <code>1</code> and stores it back into <code>eax</code>.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>|                    |
</span><span>----------------------       -----
</span><span>|        6           |       |eax|
</span><span>----------------------       -----
</span><span>|       rbp          | &lt;-rsp | 5 |
</span><span>----------------------       -----
</span><span>|                    |
</span><span>
</span><span>Fig: The current stack status and the value at eax register.
</span></code></pre>
<p>The next instruction: </p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">mov </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">8</span><span>], </span><span style="color:#bf616a;">eax
</span></code></pre>
<p>copies the value at <code>eax</code> into the memory location <code>8</code> bytes below the address at <code>rbp</code>.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>|                    |
</span><span>----------------------
</span><span>|        5           |
</span><span>----------------------       -----
</span><span>|        6           |       |eax|
</span><span>----------------------       -----
</span><span>|       rbp          | &lt;-rsp | 5 |
</span><span>----------------------       -----
</span><span>|                    |
</span><span>
</span><span>Fig: The current stack status and the value at eax register.
</span></code></pre>
<p>The next instruction:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">mov </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">4</span><span>]
</span></code></pre>
<p>copies the value at the location <code>4</code> bytes below the address stored by the <code>rbp</code> register.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>|                    |
</span><span>----------------------
</span><span>|        5           |
</span><span>----------------------       -----
</span><span>|        6           |       |eax|
</span><span>----------------------       -----
</span><span>|       rbp          | &lt;-rsp | 6 |
</span><span>----------------------       -----
</span><span>|                    |
</span><span>
</span><span>Fig: The current stack status and the value at eax register.
</span></code></pre>
<p>The next instruction:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">add </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#d08770;">7
</span></code></pre>
<p>adds the value <code>7</code> to the value stored at the <code>eax</code> register.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>|                    |
</span><span>----------------------
</span><span>|        5           |
</span><span>----------------------       -------
</span><span>|        6           |       | eax |
</span><span>----------------------       -------
</span><span>|       rbp          | &lt;-rsp | 13  |
</span><span>----------------------       -------
</span><span>|                    |
</span><span>
</span><span>Fig: The current stack status and the value at eax register.
</span></code></pre>
<p>Similarly the next instruction:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">mov </span><span style="color:#96b5b4;">DWORD PTR </span><span>[</span><span style="color:#bf616a;">rbp</span><span>-</span><span style="color:#d08770;">8</span><span>], </span><span style="color:#bf616a;">eax
</span><span>
</span></code></pre>
<p>copies the value at <code>eax</code> into <code>[rbp-8]</code>.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>|                    |
</span><span>----------------------
</span><span>|        13          |
</span><span>----------------------       -------
</span><span>|        6           |       | eax |
</span><span>----------------------       -------
</span><span>|       rbp          | &lt;-rsp | 13  |
</span><span>----------------------       -------
</span><span>|                    |
</span><span>
</span><span>Fig: The current stack status and the value at eax register.
</span></code></pre>
<p>The next instruction:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">mov </span><span style="color:#bf616a;">eax</span><span>, </span><span style="color:#d08770;">0
</span></code></pre>
<p>sets the value <code>0</code> at the <code>eax</code> register.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>|                    |
</span><span>----------------------
</span><span>|        13          |
</span><span>----------------------       -------
</span><span>|        6           |       | eax |
</span><span>----------------------       -------
</span><span>|       rbp          | &lt;-rsp |  0  |
</span><span>----------------------       -------
</span><span>|                    |
</span><span>
</span><span>Fig: The current stack status and the value at eax register.
</span></code></pre>
<p>The next instruction :</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">pop </span><span style="color:#bf616a;">rbp
</span></code></pre>
<p>pops the value from the stack and store it back into <code>rbp</code>. The pop operation moves the <code>rsp</code> downwards.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>|                    |
</span><span>----------------------
</span><span>|        13          |
</span><span>----------------------       -------
</span><span>|        6           |       | eax |
</span><span>----------------------       -------
</span><span>|       rbp          |       |  0  |
</span><span>----------------------       -------
</span><span>|                    | &lt;-rsp
</span><span>----------------------
</span><span>|                    |
</span><span>
</span><span>Fig: The current stack status and the value at eax register.
</span><span>
</span></code></pre>
<p>The last instruction:</p>
<pre data-lang="asm" style="background-color:#2b303b;color:#c0c5ce;" class="language-asm "><code class="language-asm" data-lang="asm"><span style="color:#b48ead;">ret
</span></code></pre>
<p>returns from the function. It basically sets the execution to the line after the function call.</p>
<p>This is it for this article. We'll look into more Compiler Stuffs in the next article.</p>
<p>I write articles and courses for <a href="https://programiz.pro">Programiz.pro</a>. Have a look at the <a href="https://programiz.pro/learn/master-cpp">Master C++ Course</a></p>
<p>Happy Learning!</p>

    </div>
</article>

        </main>
        
        <footer>
            
            <div class="border"></div>
            <div class="footer">
                <small class="footer-left">
                    Copyright &copy; Abhilekh Gautam
                </small>
                <small class="footer-right">
                    Powered by <a href="https://www.getzola.org">Zola</a> | Theme <a href="https://github.com/barlog-m/oceanic-zen">Oceanic Zen</a>
                </small>
            </div>
        
        </footer>
    
        </div>
    </body>
</html>
